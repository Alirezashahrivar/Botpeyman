# -*- coding: utf-8 -*-
"""Untitled13.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1c3DxZ3JBVTAHeFYwQ163CRgf5YaTej0q
"""

##bot is mine

import nest_asyncio
import asyncio

nest_asyncio.apply()





from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ConversationHandler,
    ContextTypes,
)
import nest_asyncio
import asyncio

nest_asyncio.apply()

# Ø´Ù†Ø§Ø³Ù‡ Ù…Ø¯ÛŒØ±
ADMIN_CHAT_ID = 685549695  # Ø´Ù†Ø§Ø³Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø´Ù…Ø§
CHANNEL_USERNAME = "@Tabadole_test"  # Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù…

# ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ú©Ø§Ù„Ù…Ù‡
ASK_NAME, ASK_SURNAME, ASK_PHONE, ASK_CITY, SHOW_OPTIONS, TRADE_TYPE, \
ASK_PAYMENT_METHOD, ASK_COUNTRY, ASK_AMOUNT, ASK_PRICE, ADMIN_DECISION, \
GRE_USERNAME, GRE_PASSWORD, GRE_EXAM_TYPE, GRE_EXAM_DATE, GRE_CENTER, \
GRE_TIME, GRE_DISCOUNT_CODE, GRE_NOTES, APPLICANT_INFO, APPLICANT_NAME, \
APPLICANT_LAST_NAME, APPLICATION_LOOP, APPLICATION_DETAILS = range(24)

# Ø´Ø±ÙˆØ¹ Ø±Ø¨Ø§Øª
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Ø³Ù„Ø§Ù…! Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
    return ASK_NAME

# Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù…
async def ask_name(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data['name'] = update.message.text
    await update.message.reply_text("Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
    return ASK_SURNAME

# Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ
async def ask_surname(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data['surname'] = update.message.text
    await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
    return ASK_PHONE

# Ø¯Ø±ÛŒØ§ÙØª Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
async def ask_phone(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data['phone'] = update.message.text
    await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ø´Ù‡Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
    return ASK_CITY

# Ø¯Ø±ÛŒØ§ÙØª Ø´Ù‡Ø± Ùˆ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
async def ask_city(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data['city'] = update.message.text
    name = context.user_data['name']
    surname = context.user_data['surname']
    city = context.user_data['city']

    await update.message.reply_text(f"Ù…Ù…Ù†ÙˆÙ† {name} {surname} Ø§Ø² {city}!")
    reply_keyboard = [["Ø´Ø±ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ ğŸ’±", "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ø²Ù…ÙˆÙ† Ù‡Ø§ÛŒ Ø²Ø¨Ø§Ù† ğŸ“‘", "Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ ğŸ«"], ["ØªÙ†Ø¸ÛŒÙ…Ø§Øª âš™ï¸", "Ø±Ø§Ù‡Ù†Ù…Ø§ ğŸ†˜", "Ù„ØºÙˆ âŒ"]]
    await update.message.reply_text("ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True))
    return SHOW_OPTIONS

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
async def handle_options(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_choice = update.message.text
    if user_choice == "Ø´Ø±ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ ğŸ’±":
        reply_keyboard = [["Ø®Ø±ÛŒØ¯ ğŸ“ˆ", "ÙØ±ÙˆØ´ ğŸ“‰"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
        await update.message.reply_text("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø±ÛŒØ¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´ØŸ", reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True))
        return TRADE_TYPE
    elif user_choice == "Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ø²Ù…ÙˆÙ† Ù‡Ø§ÛŒ Ø²Ø¨Ø§Ù† ğŸ“‘":
        reply_keyboard = [["GRE", "TOEFL"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
        await update.message.reply_text(
            "Ù„Ø·ÙØ§Ù‹ Ø¢Ø²Ù…ÙˆÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
        )
        return GRE_USERNAME
    elif user_choice == "Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ ğŸ«":
        await handle_application_fee(update, context)  # Call the university fee handler
        return APPLICANT_INFO
    elif user_choice == "ØªÙ†Ø¸ÛŒÙ…Ø§Øª âš™ï¸":
        await update.message.reply_text("Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.")
        return SHOW_OPTIONS
    elif user_choice == "Ø±Ø§Ù‡Ù†Ù…Ø§ ğŸ†˜":
        await update.message.reply_text("Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.")
        return SHOW_OPTIONS
    elif user_choice == "Ù„ØºÙˆ âŒ":
        await update.message.reply_text("Ù…Ú©Ø§Ù„Ù…Ù‡ Ù„ØºÙˆ Ø´Ø¯.")
        return ConversationHandler.END
    else:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")
        return SHOW_OPTIONS

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø±ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´
async def handle_trade_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
    trade_choice = update.message.text
    context.user_data['trade_type'] = "Ø®Ø±ÛŒØ¯" if trade_choice == "Ø®Ø±ÛŒØ¯ ğŸ“ˆ" else "ÙØ±ÙˆØ´"
    reply_keyboard = [["Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ", "Ù¾ÛŒâ€ŒÙ¾Ø§Ù„", "Ù†Ù‚Ø¯ÛŒ"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
    await update.message.reply_text(
        "Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù¾ÙˆÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª ÛŒØ§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯ØŸ",
        reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
    )
    return ASK_PAYMENT_METHOD

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
async def handle_payment_method(update: Update, context: ContextTypes.DEFAULT_TYPE):
    payment_method = update.message.text
    if payment_method == "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ù†Ú©ÛŒ":
        context.user_data['payment_method'] = payment_method
        reply_keyboard = [["Ø¢Ù„Ù…Ø§Ù†", "ÙØ±Ø§Ù†Ø³Ù‡", "Ø§ÛŒØªØ§Ù„ÛŒØ§", "Ù‡Ù„Ù†Ø¯"], ["Ø§Ø³Ù¾Ø§Ù†ÛŒØ§", "Ø§ØªØ±ÛŒØ´", "Ø³ÙˆØ¦ÛŒØ³", "Ø§Ù†Ú¯Ù„Ø³ØªØ§Ù†"], ["Ø³Ø§ÛŒØ± Ù…ÙˆØ§Ø±Ø¯"]]
        await update.message.reply_text(
            "Ù„Ø·ÙØ§Ù‹ Ú©Ø´ÙˆØ±ÛŒ Ú©Ù‡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ Ø¯Ø§Ø±ÛŒØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
        )
        return ASK_COUNTRY
    elif payment_method in ["Ù¾ÛŒâ€ŒÙ¾Ø§Ù„", "Ù†Ù‚Ø¯ÛŒ"]:
        context.user_data['payment_method'] = payment_method
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± ÛŒÙˆØ±Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return ASK_AMOUNT
    else:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")
        return ASK_PAYMENT_METHOD

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø´ÙˆØ±
async def handle_country(update: Update, context: ContextTypes.DEFAULT_TYPE):
    country = update.message.text
    if country == "Ø³Ø§ÛŒØ± Ù…ÙˆØ§Ø±Ø¯":
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø´ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return ASK_COUNTRY

    context.user_data['country'] = country
    await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± ÛŒÙˆØ±Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
    return ASK_AMOUNT

# Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø±
async def handle_amount(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        context.user_data['amount'] = float(update.message.text)
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù‚ÛŒÙ…Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÛŒÙˆØ±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø¨Ù‡ ØªÙˆÙ…Ø§Ù†):")
        return ASK_PRICE
    except ValueError:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.")
        return ASK_AMOUNT

# Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª
async def handle_price(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        context.user_data['price'] = float(update.message.text)
        name = context.user_data['name']
        surname = context.user_data['surname']
        phone = context.user_data['phone']
        city = context.user_data['city']
        trade_type = context.user_data['trade_type']
        payment_method = context.user_data['payment_method']
        country = context.user_data.get('country', "Ù†Ø§Ù…Ø´Ø®Øµ")
        amount = context.user_data['amount']
        price = context.user_data['price']

        # Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù…Ø¯ÛŒØ±
        message = (f"Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯:\n"
                   f"Ù†Ø§Ù…: {name}\n"
                   f"Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: {surname}\n"
                   f"Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†: {phone}\n"
                   f"Ø´Ù‡Ø±: {city}\n"
                   f"Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡: {trade_type}\n"
                   f"Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: {payment_method}\n"
                   f"Ú©Ø´ÙˆØ±: {country}\n"
                   f"Ù…Ù‚Ø¯Ø§Ø±: {amount} ÛŒÙˆØ±Ùˆ\n"
                   f"Ù‚ÛŒÙ…Øª: {price} ØªÙˆÙ…Ø§Ù†")
        await context.bot.send_message(chat_id=ADMIN_CHAT_ID, text=message)

        # Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„
        reply_keyboard = [["Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ğŸ“¢", "Ù„ØºÙˆ âŒ"]]
        await update.message.reply_text("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ØŸ", reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True))
        return ADMIN_DECISION
    except ValueError:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.")
        return ASK_PRICE

# ØªØµÙ…ÛŒÙ… Ù…Ø¯ÛŒØ±
async def handle_admin_decision(update: Update, context: ContextTypes.DEFAULT_TYPE):
    decision = update.message.text
    if decision == "Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ğŸ“¢":
        # Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„
        message = (f"Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯:\n"
                   f"Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡: {context.user_data['trade_type']}\n"
                   f"Ù…Ù‚Ø¯Ø§Ø±: {context.user_data['amount']} ÛŒÙˆØ±Ùˆ\n"
                   f"Ù‚ÛŒÙ…Øª: {context.user_data['price']} ØªÙˆÙ…Ø§Ù†\n"
                   f"Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: {context.user_data['payment_method']}\n"
                   f"Ú©Ø´ÙˆØ±: {context.user_data.get('country', 'Ù†Ø§Ù…Ø´Ø®Øµ')}\n")
        await context.bot.send_message(chat_id=CHANNEL_USERNAME, text=message)
        await update.message.reply_text("Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
    elif decision == "Ù„ØºÙˆ âŒ":
        await update.message.reply_text("Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ù„ØºÙˆ Ø´Ø¯.")
    else:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")
        return ADMIN_DECISION

    return ConversationHandler.END

# Ù„ØºÙˆ Ù…Ú©Ø§Ù„Ù…Ù‡
async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Ù…Ú©Ø§Ù„Ù…Ù‡ Ù„ØºÙˆ Ø´Ø¯.")
    return ConversationHandler.END

# Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ø²Ù…ÙˆÙ† GRE
async def handle_gre_registration(update: Update, context: ContextTypes.DEFAULT_TYPE):
    current_step = context.user_data.get('gre_step', GRE_USERNAME)

    if current_step == GRE_USERNAME:
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ETS Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        context.user_data['gre_step'] = GRE_PASSWORD
        return GRE_PASSWORD
    elif current_step == GRE_PASSWORD:
        context.user_data['username'] = update.message.text
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ETS Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        context.user_data['gre_step'] = GRE_EXAM_TYPE
        return GRE_EXAM_TYPE
    elif current_step == GRE_EXAM_TYPE:
        context.user_data['password'] = update.message.text
        reply_keyboard = [["Ø­Ø¶ÙˆØ±ÛŒ", "Home Edition"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
        await update.message.reply_text(
            "Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ† Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ (Ø­Ø¶ÙˆØ±ÛŒ ÛŒØ§ Home Edition):",
            reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
        )
        context.user_data['gre_step'] = GRE_EXAM_DATE
        return GRE_EXAM_DATE
    elif current_step == GRE_EXAM_DATE:
        context.user_data['exam_type'] = update.message.text
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø¢Ø²Ù…ÙˆÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø¨Ù‡â€ŒØµÙˆØ±Øª YYYY-MM-DD):")
        context.user_data['gre_step'] = GRE_CENTER
        return GRE_CENTER
    elif current_step == GRE_CENTER:
        context.user_data['exam_date'] = update.message.text
        await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ù…Ø±Ú©Ø² Ø¢Ø²Ù…ÙˆÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        context.user_data['gre_step'] = GRE_TIME
        return GRE_TIME
    elif current_step == GRE_TIME:
        context.user_data['exam_center'] = update.message.text
        reply_keyboard = [["ØµØ¨Ø­", "Ø¹ØµØ±"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
        await update.message.reply_text(
            "Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ (ØµØ¨Ø­ ÛŒØ§ Ø¹ØµØ±):",
            reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
        )
        context.user_data['gre_step'] = GRE_DISCOUNT_CODE
        return GRE_DISCOUNT_CODE
    elif current_step == GRE_DISCOUNT_CODE:
        context.user_data['exam_time'] = update.message.text
        reply_keyboard = [["Ø¨Ù„Ù‡", "Ø®ÛŒØ±"], ["Ø¨Ø§Ø²Ú¯Ø´Øª ğŸ”™"]]
        await update.message.reply_text(
            "Ø¢ÛŒØ§ Ú©Ø¯ ØªØ®ÙÛŒÙ ETS Ø¯Ø§Ø±ÛŒØ¯ØŸ",
            reply_markup=ReplyKeyboardMarkup(reply_keyboard, resize_keyboard=True),
        )
        context.user_data['gre_step'] = GRE_NOTES
        return GRE_NOTES
    elif current_step == GRE_NOTES:
        if update.message.text == "Ø¨Ù„Ù‡":
            await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ ØªØ®ÙÛŒÙ ETS Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
            return GRE_NOTES + 1
        elif update.message.text == "Ø®ÛŒØ±":
            await update.message.reply_text("Ø§Ú¯Ø± ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø¯Ø§Ø±ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŒ Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯ 'Ù†Ø¯Ø§Ø±Ù…':")
            return GRE_NOTES + 1
        else:
            await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.")
            return GRE_DISCOUNT_CODE
    elif current_step == GRE_NOTES + 1:
        context.user_data['discount_code'] = update.message.text
        await update.message.reply_text("ÙØ±Ø¢ÛŒÙ†Ø¯ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!")
        return ConversationHandler.END
    else:
        await update.message.reply_text("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")
        return ConversationHandler.END

# Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ù‡Ø§
async def handle_application_fee(update: Update, context: ContextTypes.DEFAULT_TYPE): #new
    current_step = context.user_data.get('application_step', APPLICANT_INFO)

    if current_step == APPLICANT_INFO:
        await update.message.reply_text(
            "Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú†Ù‡ Ú©Ø³ÛŒ Ø«Ø¨Øª Ù…ÛŒ Ú©Ù†ÛŒØ¯ØŸ",
            reply_markup=ReplyKeyboardMarkup([
                ["Ø®ÙˆØ¯Ù…", "ÙØ±Ø¯ Ø¯ÛŒÚ¯Ø±ÛŒ"]
            ], resize_keyboard=True)
        )
        context.user_data['application_step'] = APPLICANT_NAME
        return APPLICANT_NAME

    elif current_step == APPLICANT_NAME:
        context.user_data['applicant_for'] = update.message.text
        await update.message.reply_text(
            "Ù„Ø·ÙØ§ Ù†Ø§Ù… Ù¾Ø§Ø³Ù¾ÙˆØ±ØªÛŒ Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:*"
        )
        context.user_data['application_step'] = APPLICANT_LAST_NAME
        return APPLICANT_LAST_NAME

    elif current_step == APPLICANT_LAST_NAME:
        context.user_data['applicant_name'] = update.message.text
        await update.message.reply_text(
            "Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù¾Ø§Ø³Ù¾ÙˆØ±ØªÛŒ Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:*"
        )
        context.user_data['application_step'] = APPLICATION_LOOP
        return APPLICATION_LOOP

    elif current_step == APPLICATION_LOOP:
        context.user_data['applicant_last_name'] = update.message.text
        await update.message.reply_text(
            "Ù„Ø·ÙØ§ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ø§ Ø¨ÛŒÙ† 1 ØªØ§ 5 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:"
        )
        context.user_data['application_step'] = APPLICATION_DETAILS
        return APPLICATION_DETAILS

    elif current_step == APPLICATION_DETAILS:
        try:
            application_count = int(update.message.text)
            if 1 <= application_count <= 5:
                context.user_data['application_count'] = application_count
                for i in range(1, application_count + 1):
                    await update.message.reply_text(
                        f"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø±Ø­Ù„Ù‡ {i}:\n"
                        "Ù„ÛŒÙ†Ú© ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡:*"
                    )
                    await update.message.reply_text("Ù…Ø¨Ù„Øº Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙÛŒ Ø¨Ù‡ ÛŒÙˆØ±Ùˆ:*")
                    await update.message.reply_text("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:*")
                    await update.message.reply_text("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:*"
                    # await update.message.reply_text(
                    #     "ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ Ø¯Ø³ØªÙˆØ± Ø§Ù„Ø¹Ù…Ù„ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ÙˆÛŒØ²Ø§ Ú©Ø§Ø±Øª/Ù…Ø³ØªØ± Ú©Ø§Ø±Øª/Ù¾ÛŒ Ù¾Ø§Ù„"
                    )
                await update.message.reply_text("ÙØ±Ø¢ÛŒÙ†Ø¯ Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!")
                return ConversationHandler.END
            else:
                await update.message.reply_text("Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 1 ØªØ§ 5 Ø¨Ø§Ø´Ø¯.")
                return APPLICATION_LOOP
        except ValueError:
            await update.message.reply_text("Ù„Ø·ÙØ§ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.")
            return APPLICATION_LOOP

# ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
import asyncio
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ConversationHandler,
    ContextTypes,
)

# Ensure you have imported all required dependencies and your bot functions

async def main():
    try:
        # Initialize application with bot token
        application = Application.builder().token("7567022859:AAEwxlLSEH0JV00LkeLVnYlocEgAF8wYOqI").build()

        # Setup ConversationHandler
        conv_handler = ConversationHandler(
            entry_points=[CommandHandler('start', start)],
            states={
                ASK_NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, ask_name)],
                ASK_SURNAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, ask_surname)],
                ASK_PHONE: [MessageHandler(filters.TEXT & ~filters.COMMAND, ask_phone)],
                ASK_CITY: [MessageHandler(filters.TEXT & ~filters.COMMAND, ask_city)],
                SHOW_OPTIONS: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_options)],
                TRADE_TYPE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_trade_type)],
                ASK_PAYMENT_METHOD: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_payment_method)],
                ASK_COUNTRY: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_country)],
                ASK_AMOUNT: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_amount)],
                ASK_PRICE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_price)],
                ADMIN_DECISION: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_admin_decision)],
                GRE_USERNAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_PASSWORD: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_EXAM_TYPE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_EXAM_DATE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_CENTER: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_TIME: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_DISCOUNT_CODE: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                GRE_NOTES: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_gre_registration)],
                APPLICANT_INFO: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_application_fee)],
                APPLICANT_NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_application_fee)],
                APPLICANT_LAST_NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_application_fee)],
                APPLICATION_LOOP: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_application_fee)],
                APPLICATION_DETAILS: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_application_fee)],
            },
            fallbacks=[CommandHandler('cancel', cancel)],
        )

        # Add handlers to the application
        application.add_handler(conv_handler)

        # Start the bot
        print("Bot is running...")
        await application.run_polling()
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    asyncio.run(main())

